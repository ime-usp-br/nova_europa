[www]
; Listen on localhost port 9000 (same container as Nginx)
listen = 127.0.0.1:9000

user = www-data
group = www-data

; Process management
pm = dynamic
pm.max_children = 50
pm.start_servers = 5
pm.min_spare_servers = 5
pm.max_spare_servers = 35
pm.max_requests = 500

; Logging
catch_workers_output = yes
php_admin_value[error_log] = /var/www/html/storage/logs/php-fpm.log
php_admin_flag[log_errors] = on

; Security
; Note: proc_open is required for Browsershot/Puppeteer PDF generation
php_admin_value[disable_functions] = exec,passthru,shell_exec,system,popen

; Environment variables - PHP-FPM needs these explicitly passed
; Laravel core variables
env[APP_NAME] = $APP_NAME
env[APP_KEY] = $APP_KEY
env[APP_ENV] = $APP_ENV
env[APP_DEBUG] = $APP_DEBUG
env[APP_URL] = $APP_URL
env[APP_LOCALE] = $APP_LOCALE
env[APP_FALLBACK_LOCALE] = $APP_FALLBACK_LOCALE
env[APP_FAKER_LOCALE] = $APP_FAKER_LOCALE

; Database variables
env[DB_CONNECTION] = $DB_CONNECTION
env[DB_HOST] = $DB_HOST
env[DB_PORT] = $DB_PORT
env[DB_DATABASE] = $DB_DATABASE
env[DB_USERNAME] = $DB_USERNAME
env[DB_PASSWORD] = $DB_PASSWORD

; Redis variables
env[REDIS_HOST] = $REDIS_HOST
env[REDIS_PORT] = $REDIS_PORT
env[CACHE_STORE] = $CACHE_STORE
env[SESSION_DRIVER] = $SESSION_DRIVER

; USP Senha Ãšnica (OAuth)
env[SENHAUNICA_KEY] = $SENHAUNICA_KEY
env[SENHAUNICA_SECRET] = $SENHAUNICA_SECRET
env[SENHAUNICA_CALLBACK_ID] = $SENHAUNICA_CALLBACK_ID

; Replicado variables (uspdev/replicado uses getenv())
env[REPLICADO_HOST] = $REPLICADO_HOST
env[REPLICADO_PORT] = $REPLICADO_PORT
env[REPLICADO_DATABASE] = $REPLICADO_DATABASE
env[REPLICADO_USERNAME] = $REPLICADO_USERNAME
env[REPLICADO_PASSWORD] = $REPLICADO_PASSWORD
env[REPLICADO_CODUNDCLG] = $REPLICADO_CODUNDCLG
env[REPLICADO_PATHLOG] = $REPLICADO_PATHLOG
env[REPLICADO_SYBASE] = $REPLICADO_SYBASE
env[REPLICADO_USAR_CACHE] = $REPLICADO_USAR_CACHE
env[REPLICADO_DEBUG] = $REPLICADO_DEBUG
env[REPLICADO_DEBUG_LEVEL] = $REPLICADO_DEBUG_LEVEL

; Mail variables
env[MAIL_MAILER] = $MAIL_MAILER
env[MAIL_HOST] = $MAIL_HOST
env[MAIL_PORT] = $MAIL_PORT
env[MAIL_USERNAME] = $MAIL_USERNAME
env[MAIL_PASSWORD] = $MAIL_PASSWORD
env[MAIL_ENCRYPTION] = $MAIL_ENCRYPTION
env[MAIL_FROM_ADDRESS] = $MAIL_FROM_ADDRESS
env[MAIL_FROM_NAME] = $MAIL_FROM_NAME
